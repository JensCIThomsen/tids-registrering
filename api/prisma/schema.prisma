generator client {
  provider = "prisma-client-js"
}

// prisma/schema.prisma
datasource db {
  provider  = "postgresql"
}

enum Role {
	SUPERADMIN
	COMPANY_ADMIN
	EMPLOYEE
}

enum AttendanceType {
	MOEDT
	GAAET
	PAUSE_START
	PAUSE_END
}

model Company {
	id        String   @id @default(cuid())
	name      String
	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt

	users     User[]
}

model User {
	id        String   @id @default(cuid())
	email     String   @unique
	name      String?
	role      Role     @default(EMPLOYEE)

	// --- arbejdstid / pause-regel (fast pr. employee) ---
	weeklyHours			Int			@default(37)	// fx 37 timer/uge
	breakMinutesPerDay	Int			@default(30)	// fx 30 min middagspause
	breakIsPaid			Boolean		@default(false)	// false = selvbetalt pause

	isDepartmentLeader	Boolean	@default(false)
	managerId			String?
	manager				User?	@relation("UserManager", fields: [managerId], references: [id], onDelete: SetNull)
	employees			User[]	@relation("UserManager")

	@@index([companyId, isDepartmentLeader])
	@@index([managerId])

	companyId String?
	company   Company?  @relation(fields: [companyId], references: [id], onDelete: Cascade)

	createdAt DateTime @default(now())
	updatedAt DateTime @updatedAt

	attendance Attendance[]
	passwordHash String?

}

model Attendance {
	id        String         @id @default(cuid())
	type      AttendanceType
	at        DateTime       @default(now())

	userId    String
	user      User           @relation(fields: [userId], references: [id], onDelete: Cascade)

	// hj√¶lper queries: "seneste event for user"
	@@index([userId, at])
}
